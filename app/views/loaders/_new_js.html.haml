:javascript
  $(function () {
    activate_form();
  });
  function activate_form(){
    var file_list = [];
    $(".progress").hide();
    $('#loaderForm').fileupload({
        dataType: 'html',
        replaceFileInput: false,
        autoUpload: false,
        add: function (e, data) {
            data.context = $("#loaderSubmit").click(function (e) {
              e.preventDefault();
            });
          $(".progress").show();
          file_list = [data.files[0]]; //this guarantees that the files being uploaded is only the most recently added one
        },
        progressall: function (e, data) {
            var progress = parseInt(data.loaded / data.total * 100, 10);
            $('.progress .bar').css(
                'width',
                progress + '%'
            );
            if (progress == 100) {
              $(".progress").after("<div class='alert alert-success'>Your file has been uploaded and is now being processed.</div>");
              spinner = enable_spinner('main-content');
            }
        },
        done: function (e, data) {
          response = JSON.parse(data.result);
          if ('comparison_file_pid' in response) {
            window.location = "/loaders/#{@loader_short_name}/preview_compare/"+response.report_id;
          } else if ('preview_file_pid' in response) {
            window.location = "/loaders/#{@loader_short_name}/preview/"+response.report_id;
          } else if (response.report_id != undefined){
            window.location = "/loaders/#{@loader_short_name}/report/"+response.report_id;
          } else {
            if (response[0].error != undefined){
              window.location = "/my_loaders";
            }
          }
        },
        fail: function(data){
          bootbox.alert("There was an issue processing your load.");
          window.location = "/my_loaders";
        }
    });
    $('#loaderSubmit').click(function(e){
      e.preventDefault();
      if($("#collection_parent").val() == "" || $("#parent").val() == ""){
        bootbox.alert("Please select a destination collection from the dropdown.");
        return;
      }
      if (file_list.length != 1){
        bootbox.alert("Please upload a zip file.");
        return;
      }
      $(this).attr("disabled", true);
      $(this).val("Please wait...");
      $('#loaderForm').fileupload('send', {files:file_list});
    });
  }
