- content_for :page_header do
  %style{:type=>"text/css"}
    = raw @diff_css

%ul.breadcrumb
  %li
    = link_to "Manage #{@core_file.title}", edit_core_file_path(id: @core_file.pid)
  %li
    = link_to 'Rights History List', core_file_rights_history_list_path(id: @core_file.pid)
  %li.active
    = @core_file.rightsMetadata.versions[params[:page].to_i - 1].createDate.localtime.to_s

%header
  %h1.page-header
    Rights History for
    %i
      = "#{@core_file.non_sort} "
      = kramdown_parse(@core_file.title)

= will_paginate @rights_pages, :previous_label => '< Newer', :next_label => 'Older >'

.span6
  %h3
    XML as of
    = @core_file.rightsMetadata.versions[params[:page].to_i - 1].createDate.localtime.to_s
  %label.text-right
    %input#toggle_word_wrap{"type"=>"checkbox"}
    ="Toggle Word Wrap"
  #editor.well
    = @core_file.rightsMetadata.versions[params[:page].to_i - 1].content

.span5
  %h3 Rights Changes from previous version
  #rights_diff
    = @diff

%script{charset: "utf-8", src: "/ace/ace.js", type: "text/javascript"}

:javascript
  // This is a hack, need to trim to due haml pretty printing
  str = $("#editor").text();
  $("#editor").text(str.trim());

  // Setting up the editor
  var editor = ace.edit("editor");
  editor.setTheme("ace/theme/eclipse");
  editor.getSession().setMode("ace/mode/xml");
  editor.setOptions({
    maxLines: Infinity,
    minLines: 20,
    useSoftTabs: true,
    showInvisibles: false,
    showGutter: false,
    readOnly: true,
  });

  $(function() {
    $('#toggle_word_wrap').on('change', function(){
      if ($('#toggle_word_wrap').is(':checked')){
        editor.getSession().setUseWrapMode(true);
      } else {
        editor.getSession().setUseWrapMode(false);
      }
    })
  });
